# Интеграция астрономических данных (эфемерид) в гороскопы

## Обзор

Данная функциональность добавляет расчет точных астрономических положений планет (эфемерид) и включает эту информацию в промты для ассистентов OpenAI, что позволяет генерировать более точные и астрономически корректные гороскопы.

## Что такое эфемериды?

Эфемериды - это таблицы или данные, показывающие положение небесных тел (планет, Луны, Солнца и т.д.) в определенные моменты времени. В астрологии эти данные используются как основа для интерпретации влияния планет на земные события и личности.

## Реализованная функциональность

1. **Модуль ephemeris.py**:
   - Расчет точных положений планет с помощью библиотеки `ephem`
   - Определение знаков зодиака для каждой планеты
   - Расчет фазы луны
   - Определение аспектов между планетами
   - Формирование отчетов в текстовом и HTML форматах

2. **Интеграция с генерацией гороскопов**:
   - Автоматическое включение эфемерид в запросы к OpenAI Assistant
   - Корректная обработка ситуаций, когда библиотека `ephem` недоступна
   - Подробные логи о расчетах эфемерид

## Как это работает

Когда скрипт `daily_horoscope_replace.py` создает промт для OpenAI Assistant, он:

1. Проверяет наличие модуля `ephemeris`
2. Рассчитывает актуальные положения планет на дату гороскопа
3. Формирует удобочитаемый отчет об эфемеридах
4. Добавляет этот отчет к основному промту для ассистента

Пример включаемых данных:
```
Астрономічні дані на 25.06.2023:
=====================================
Sun: Cancer 4.12° (Magnitude: -26.73)
Moon: Leo 22.45° (Magnitude: -12.14)
Mercury: Gemini 28.01° (Magnitude: 0.37)
Venus: Leo 7.33° (Magnitude: -4.41)
Mars: Leo 5.78° (Magnitude: 1.15)
Jupiter: Taurus 15.89° (Magnitude: -2.20)
Saturn: Pisces 7.25° (Magnitude: 0.70)
...

Moon Phase: Waxing Gibbous (94.2%)

Significant Aspects:
----------------------------------------
Sun Conjunction Mars (orb: 1.66°)
Venus Conjunction Mars (orb: 1.55°)
Jupiter Trine Saturn (orb: 8.64°)
```

## Выгоды от использования эфемерид

1. **Точность**: Гороскопы основываются на реальных астрономических данных
2. **Согласованность**: Все гороскопы используют одинаковые базовые данные о планетарных позициях
3. **Детальность**: Ассистенты могут интерпретировать специфические аспекты и положения
4. **Подлинность**: Соответствие реальным астрономическим данным повышает качество гороскопов

## Тестирование

Для проверки расчета эфемерид используйте:
```
python test_ephemeris.py
```

Или запустите соответствующий батник/скрипт:
- Windows: `test_ephemeris.bat`
- Linux/Mac: `test_ephemeris.sh`
- PowerShell: `test_ephemeris.ps1`

## Требования

- Python 3.6 или новее
- Библиотека `ephem` (уже включена в requirements.txt)
- Библиотека `pytz` (для корректной работы с часовыми поясами)

## Примечания

- Если библиотека `ephem` отсутствует, скрипт продолжит работу без эфемерид
- Все расчеты выполняются для времени UTC
- По умолчанию используется местоположение Киева, Украина
