# Многоязычные гороскопы: система автоматического перевода

**Дата обновления:** 25.06.2025

## Введение

В этом документе описана система автоматического перевода гороскопов на различные языки с использованием OpenAI Translation Assistant. Система интегрирована в основной скрипт генерации гороскопов и позволяет автоматически переводить содержимое на английский, немецкий и русский языки.

## Обзор функциональности

Система перевода гороскопов включает следующие ключевые компоненты:

1. **Класс переводчика `HoroscopeTranslator`** (файл `translator.py`)
   - Использует OpenAI API для перевода контента
   - Поддерживает перевод на английский, немецкий и русский языки
   - Имеет механизм ожидания и обработки ошибок

2. **Интеграция с основным скриптом генерации гороскопов**
   - Автоматически переводит заголовок, содержание и сводку гороскопа
   - Заполняет соответствующие поля в базе данных (`title_XX`, `content_XX`, `summary_XX`)
   - Контролируется через переменную окружения `USE_TRANSLATIONS`

3. **Гибкое управление переводами**
   - Активация/деактивация через .env файл или переменные окружения
   - Возможность запуска с переводами или без них
   - Настраивается в конфигурации Render для продакшена

## Технические детали

### Модель базы данных

Модель `BlogBlock` содержит поля для хранения многоязычного контента:
- `title_ua`, `title_en`, `title_de`, `title_ru` - заголовки на разных языках
- `content_ua`, `content_en`, `content_de`, `content_ru` - содержание на разных языках
- `summary_ua`, `summary_en`, `summary_de`, `summary_ru` - сводки на разных языках

### Процесс перевода

1. Генерация основного контента на украинском языке
2. Проверка доступности переводчика и наличия настройки `USE_TRANSLATIONS`
3. Последовательный перевод на каждый из поддерживаемых языков:
   - Перевод заголовка, содержания и сводки
   - Заполнение соответствующих полей в базе данных
   - Логирование результатов перевода

### Настройка и управление

#### Активация/деактивация переводов

В файле `.env`:
```
USE_TRANSLATIONS=true  # Использовать автоматический перевод гороскопов
```

В `render.yaml` (для продакшена):
```yaml
envVars:
  - key: USE_TRANSLATIONS
    value: "true"
```

## Запуск и использование

### Запуск с переводами

Для запуска только с переводами:
```
run_horoscope_with_translations.bat (Windows)
./run_horoscope_with_translations.sh (Linux/Mac)
```

### Запуск с переводами и DALL-E изображениями

Для полного запуска со всеми функциями:
```
run_horoscope_full.bat (Windows)
./run_horoscope_full.sh (Linux/Mac)
```

## Устранение неполадок

### Распространенные проблемы

1. **Отсутствие перевода**
   - Проверьте настройку `USE_TRANSLATIONS=true`
   - Убедитесь, что установлен `OPENAI_TRANSLATION_ASSISTANT_ID`
   - Проверьте действительность ключа API

2. **Ошибки перевода**
   - Проверьте логи на наличие сообщений об ошибках
   - Убедитесь, что OpenAI API работает корректно
   - Проверьте размер переводимого контента (слишком большие тексты могут вызывать ошибки)

3. **Отображение на сайте**
   - Убедитесь, что на фронтенде правильно выбирается язык контента
   - Проверьте наличие соответствующих шаблонов для разных языков

## Рекомендации по использованию

1. **Оптимизация расходов**
   - Устанавливайте `USE_TRANSLATIONS=false` во время тестирования и разработки
   - Рассмотрите возможность использования переводов только для определенных типов гороскопов
   - Мониторинг использования OpenAI API для контроля затрат

2. **Качество перевода**
   - Регулярно проверяйте качество переводов
   - Корректируйте промт-инструкции, если определенная терминология требует улучшения
   - Создайте специализированные подсказки для каждого языка

## Настройка OpenAI Translation Assistant

Для корректной работы системы перевода необходимо настроить Translation Assistant в OpenAI:

1. **Создание ассистента**
   - Создайте нового ассистента через [OpenAI Platform](https://platform.openai.com/assistants)
   - Выберите модель GPT-4 или выше
   - Установите инструкции для перевода астрологических текстов
   - Сохраните ID ассистента

2. **Пример инструкций для Translation Assistant**
```
Вы — профессиональный переводчик с опытом работы с астрологическими текстами.
Ваша задача — переводить контент гороскопов, сохраняя специфическую терминологию и стиль.

Несколько ключевых правил:
1. Сохраняйте форматирование и структуру исходного текста (абзацы, списки)
2. Поддерживайте последовательность астрологических терминов
3. Сохраняйте HTML-теги, если они присутствуют
4. Адаптируйте текст под особенности целевого языка
5. Переводите текст полностью, без сокращений
```

3. **Переменные окружения**
```
OPENAI_API_KEY=your_openai_api_key
OPENAI_TRANSLATION_ASSISTANT_ID=asst_xxxxxxxxxxxx
```
   - Используйте перевод только для новых или измененных гороскопов
   - Рассмотрите возможность кеширования переводов

2. **Контроль качества**
   - Периодически проверяйте качество автоматических переводов
   - При необходимости корректируйте системные промты для переводов

3. **Расширение функциональности**
   - При необходимости добавьте поддержку дополнительных языков
   - Рассмотрите возможность выборочного перевода только некоторых систем
