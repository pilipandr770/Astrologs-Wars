# –ö–û–ú–ê–ù–î–´ –î–õ–Ø –†–£–ß–ù–û–ô –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• –í –¢–ï–†–ú–ò–ù–ê–õ–ï RENDER

## üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –°–ü–û–°–û–ë (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
python render_manual_db_init.py

## üîß –ü–û–®–ê–ì–û–í–´–ï –ö–û–ú–ê–ù–î–´ (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
python -c "
import os
from sqlalchemy import create_engine, text
engine = create_engine(os.environ.get('DATABASE_URL'))
with engine.connect() as conn:
    result = conn.execute(text('SELECT current_database(), version()'))
    print('Connected to:', result.fetchone())
"

# 2. –°–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
python -c "
from app import create_app, db
app = create_app()
with app.app_context():
    db.create_all()
    print('Tables created successfully!')
"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
python -c "
from app import create_app, db
from sqlalchemy import inspect
app = create_app()
with app.app_context():
    inspector = inspect(db.engine)
    tables = inspector.get_table_names()
    print(f'Created tables ({len(tables)}): {tables}')
"

# 4. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python -c "
from app import create_app, db
from app.models import User
from werkzeug.security import generate_password_hash
app = create_app()
with app.app_context():
    if not User.query.filter_by(username='admin').first():
        admin = User(username='admin', email='admin@astro.com', is_admin=True)
        admin.password_hash = generate_password_hash('admin123')
        db.session.add(admin)
        db.session.commit()
        print('Admin created: username=admin, password=admin123')
    else:
        print('Admin already exists')
"

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
python -c "
from app import create_app, db
from app.models import User
app = create_app()
with app.app_context():
    users = User.query.all()
    print(f'Total users: {len(users)}')
    for user in users:
        print(f'- {user.username} (admin: {user.is_admin})')
"

## üóÑÔ∏è –ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –û–¢–õ–ê–î–ö–ò

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL
echo "DATABASE_URL: $DATABASE_URL"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
env | grep -E "(DATABASE|DB_)"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é Python —Å–µ—Å—Å–∏—é —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
python -c "
from app import create_app, db
app = create_app()
app.app_context().push()
print('App context ready. You can now use db, models, etc.')
# –û—Å—Ç–∞–≤–∏—Ç—å —Å–µ—Å—Å–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
import code
code.interact(local=locals())
"
