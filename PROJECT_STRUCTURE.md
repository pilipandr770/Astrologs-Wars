# Структура проекта астрологического сайта

## Основные компоненты

### Активные файлы (используются в production)

1. **Основные файлы веб-приложения:**
   - `wsgi.py` - точка входа для Gunicorn WSGI сервера
   - `requirements.txt` - зависимости проекта
   - `render.yaml` - конфигурация для развертывания на платформе Render
   - `build_render.sh`, `prestart.sh` - скрипты для сборки и запуска на Render

2. **Активные скрипты генерации гороскопов:**
   - `daily_horoscope_replace.py` - **ТЕКУЩИЙ АКТИВНЫЙ** скрипт генерации гороскопов с заменой старых и генерацией изображений через DALL-E 3 (обновлен 25.06.2025)
   - `translator.py` - модуль для автоматического перевода гороскопов на английский, немецкий и русский языки
   - `test_translator.py` - скрипт для тестирования функциональности перевода
   - `force_cleanup_horoscope_images.py` - скрипт очистки старых изображений гороскопов
   - `check_horoscope_images.py` - проверка изображений гороскопов
   - `daily_horoscope_with_images.py` - альтернативный скрипт с генерацией изображений
   - `schedule_horoscopes.py` - планировщик генерации гороскопов

3. **Скрипты управления базой данных:**
   - `create_tables.py` - создание таблиц в базе данных (используйте с переменной `$env:DB_SCHEMA="astrology"`)

### Директории проекта

1. **`/app`** - основной код Flask-приложения
   - `/app/models.py` - модели SQLAlchemy
   - `/app/main` - основные маршруты
   - `/app/blog` - маршруты блога
   - `/app/templates` - шаблоны Jinja2
   - `/app/static` - статические файлы (CSS, JS, изображения)

2. **`/utils`** - полезные скрипты и утилиты
   - Различные проверочные и диагностические скрипты
   - Утилиты для работы с данными
   - `/utils/database` - скрипты для управления базой данных

3. **`/docs`** - актуальная документация
   - Руководства по настройке и использованию
   - Описание архитектуры и компонентов

4. **`/archive`** - архивные и устаревшие файлы (НЕ ИСПОЛЬЗУЮТСЯ В PRODUCTION)
   - `/archive/horoscope_generators` - старые версии скриптов генерации гороскопов
   - `/archive/fixes` - скрипты исправлений, которые больше не актуальны
   - `/archive/docs` - устаревшая документация
   - `/archive/tests` - тестовые и верификационные скрипты

## Рабочий процесс и поддержка

### Генерация гороскопов

Текущий рабочий процесс использует `daily_horoscope_replace.py`, который:

1. Генерирует новые тексты гороскопов на украинском языке
2. Переводит тексты на английский, немецкий и русский языки (если включено)
3. Создает изображения для каждой системы (локально или через DALL-E 3)
4. Заменяет существующие записи вместо создания новых
5. Очищает старые неиспользуемые изображения

Запуск вручную:

**Стандартный запуск** (Windows/Linux/Mac):
```
run_horoscope_replace.bat / .sh / .ps1
```

**С включенными переводами** (Windows/Linux/Mac):
```
run_horoscope_with_translations.bat / .sh / .ps1
```

**С DALL-E изображениями** (Windows/Linux/Mac):
```
run_horoscope_with_dalle.bat / .sh / .ps1
```

**Полный запуск с переводами и DALL-E** (Windows/Linux/Mac):
```
run_horoscope_full.bat / .sh / .ps1
```

### Тестирование переводчика

Для проверки функциональности переводчика:
```
test_translator.bat / .sh / .ps1
```

### Работа с базой данных

Для работы со схемами в базе данных:
```
$env:DB_SCHEMA="astrology"
python create_tables.py
```

### Развертывание на Render

Конфигурация Render в файле `render.yaml` включает:
- Веб-сервис для основного приложения
- Cron-задание для ежедневной генерации гороскопов
- Redis для кеширования

## Принципы поддержки кода

1. **Соблюдайте структуру директорий:**
   - Новые скрипты должны располагаться в соответствующих директориях
   - Не создавайте новые файлы в корне проекта без необходимости

2. **Версионирование и архивирование:**
   - Перед значительными изменениями копируйте рабочие скрипты с новыми именами
   - Устаревшие скрипты перемещайте в `/archive`

3. **Документация:**
   - Обновляйте документацию при внесении изменений
   - Используйте комментарии в коде для сложных участков

4. **Тестирование:**
   - Проверяйте изменения локально перед деплоем
   - Используйте `check_*.py` скрипты для верификации

## Документация

Основная документация проекта:

1. **Общая документация:**
   - `PROJECT_STRUCTURE.md` - структура проекта
   - `README.md` - общая информация о проекте
   - `FINAL_SUCCESS_REPORT.md` - отчет о успешной реорганизации проекта

2. **Генерация гороскопов:**
   - `/docs/HOROSCOPE_TRANSLATION_GUIDE.md` - руководство по переводу гороскопов (украинский)
   - `/docs/HOROSCOPE_TRANSLATION_GUIDE_EN.md` - руководство по переводу гороскопов (английский)
   - `/docs/MULTILINGUAL_HOROSCOPE_QUICKREF.md` - краткая справка по многоязычным гороскопам
   - `/docs/DALLE_HOROSCOPE_INTEGRATION.md` - интеграция DALL-E для генерации изображений
   - `translator_README.md` - техническая документация модуля переводчика

## Переменные окружения

Основные переменные окружения проекта (.env):

1. **Базовые настройки:**
   - `DATABASE_URL` - URL подключения к базе данных
   - `SECRET_KEY` - секретный ключ для Flask
   - `DEBUG` - режим отладки (true/false)

2. **OpenAI и интеграция DALL-E:**
   - `OPENAI_API_KEY` - ключ API для OpenAI
   - `USE_DALLE_IMAGES` - использовать DALL-E для изображений (true/false)
   - `DALLE_IMAGE_SIZE` - размер изображений DALL-E (1024x1024, 1792x1024, 1024x1792)
   - `DALLE_IMAGE_QUALITY` - качество изображений DALL-E (standard, hd)

3. **Настройки переводчика:**
   - `USE_TRANSLATIONS` - включить автоматический перевод (true/false)
   - `OPENAI_TRANSLATION_ASSISTANT_ID` - ID ассистента для перевода
   - `TRANSLATION_MAX_RETRIES` - максимальное количество попыток перевода
   - `TRANSLATION_TIMEOUT_SECONDS` - таймаут для перевода

## Часто используемые команды

1. **Запуск локального сервера:**
   ```
   flask run
   ```

2. **Проверка генератора гороскопов:**
   ```
   python check_horoscope_images.py
   ```

3. **Генерация гороскопов вручную:**
   ```
   python daily_horoscope_replace.py
   ```

4. **Проверка блоков блога:**
   ```
   python check_blog_blocks.py
   ```
