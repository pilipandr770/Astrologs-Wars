# BLOGBLOCK CREATION AND HOROSCOPE FIX COMMANDS  
# Run these commands in the Render shell to fix the horoscope generator
# UPDATED: Using 'position' attribute (not 'order') to match existing database schema

# 1. Clean up DATABASE_URL
export DATABASE_URL=$(echo "$DATABASE_URL" | tr -d '\n')
echo "‚úÖ DATABASE_URL cleaned"

# 2. Create missing BlogBlock entries (using simple script)
python create_horoscope_blog_blocks.py

# 3. Test that all blog blocks can be found
python test_blog_blocks.py

# 4. If all tests pass, run the horoscope generator
echo "üöÄ Running horoscope generator..."
python daily_horoscope_generator.py

# Alternative: Manual creation using Python one-liner (if script fails):
# python -c "
# import os
# os.environ['DATABASE_URL'] = os.environ.get('DATABASE_URL', '').strip()
# from app import create_app, db
# from app.models import BlogBlock
# from datetime import datetime
# app = create_app()
# with app.app_context():
#     systems = [('–Ñ–≤—Ä–æ–ø–µ–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 1), ('–ö–∏—Ç–∞–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 2), ('–Ü–Ω–¥—ñ–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 3), ('–õ–∞–ª –ö—ñ—Ç–∞–±', 4), ('–î–∂–π–æ—Ç—ñ—à', 5), ('–ù—É–º–µ—Ä–æ–ª–æ–≥—ñ—è', 6), ('–¢–∞—Ä–æ', 7), ('–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 8)]
#     for name, pos in systems:
#         existing = BlogBlock.query.filter_by(position=pos).first()
#         if not existing:
#             block = BlogBlock(title=name, content=f'–ì–æ—Ä–æ—Å–∫–æ–ø {name}', summary=f'–ö—Ä–∞—Ç–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø {name}', position=pos, is_active=True, created_at=datetime.utcnow())
#             db.session.add(block)
#             print(f'Created: {name} (position={pos})')
#         else:
#             existing.is_active = True
#             print(f'Activated: {name} (position={pos})')
#     db.session.commit()
#     print('Done!')
# "

echo "üéâ BlogBlock creation and horoscope generator fix completed!"
