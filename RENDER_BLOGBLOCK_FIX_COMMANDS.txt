# BLOGBLOCK MIGRATION AND HOROSCOPE FIX COMMANDS
# Run these commands in the Render shell to fix the horoscope generator

# 1. Clean up DATABASE_URL
export DATABASE_URL=$(echo "$DATABASE_URL" | tr -d '\n')
echo "‚úÖ DATABASE_URL cleaned"

# 2. Run the migration script to update BlogBlock model and create missing blocks
python migrate_blog_blocks.py

# 3. Test that all blog blocks can be found
python test_blog_blocks.py

# 4. If all tests pass, run the horoscope generator
echo "üöÄ Running horoscope generator..."
python daily_horoscope_generator.py

# Alternative: If you need to manually create blog blocks, use this Python one-liner:
# python -c "
# import os
# os.environ['DATABASE_URL'] = os.environ.get('DATABASE_URL', '').strip()
# from app import create_app, db
# from app.models import BlogBlock
# from datetime import datetime
# app = create_app()
# with app.app_context():
#     systems = [('–Ñ–≤—Ä–æ–ø–µ–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 1), ('–ö–∏—Ç–∞–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 2), ('–Ü–Ω–¥—ñ–π—Å—å–∫–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 3), ('–õ–∞–ª –ö—ñ—Ç–∞–±', 4), ('–î–∂–π–æ—Ç—ñ—à', 5), ('–ù—É–º–µ—Ä–æ–ª–æ–≥—ñ—è', 6), ('–¢–∞—Ä–æ', 7), ('–ü–ª–∞–Ω–µ—Ç–∞—Ä–Ω–∞ –∞—Å—Ç—Ä–æ–ª–æ–≥—ñ—è', 8)]
#     for name, order in systems:
#         existing = BlogBlock.query.filter_by(order=order).first()
#         if not existing:
#             block = BlogBlock(title=name, content=f'–ì–æ—Ä–æ—Å–∫–æ–ø {name}', summary=f'–ö—Ä–∞—Ç–∫–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø {name}', order=order, is_active=True, created_at=datetime.utcnow())
#             db.session.add(block)
#             print(f'Created: {name} (order={order})')
#         else:
#             print(f'Exists: {name} (order={order})')
#     db.session.commit()
#     print('Done!')
# "

echo "üéâ BlogBlock migration and horoscope generator fix completed!"
