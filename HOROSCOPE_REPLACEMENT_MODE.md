# Режим замены гороскопов

## Описание

Режим замены гороскопов позволяет:

1. Обновлять существующие записи гороскопов вместо создания новых
2. Автоматически удалять старые изображения гороскопов
3. Поддерживать только один актуальный экземпляр каждого гороскопа

## Принцип работы

1. **Замена контента**:
   - Для каждой астрологической системы (позиции 1-8) существует только одна запись в базе данных
   - При генерации нового гороскопа текст и изображение заменяются, а не добавляются новыми записями
   - Поля `updated_at` обновляются для отслеживания времени последнего обновления

2. **Управление изображениями**:
   - Для каждой позиции сохраняется только одно актуальное изображение
   - Старые изображения автоматически удаляются после успешной генерации новых
   - Изображения именуются по шаблону `astro_{position}_{date}.png`

3. **Автоматическая очистка**:
   - После каждой успешной генерации запускается скрипт принудительной очистки
   - Удаляются все изображения, кроме самых последних для каждой позиции

## Преимущества

1. **Экономия места на диске**:
   - Только актуальные изображения хранятся в файловой системе
   - Нет накопления старых неиспользуемых файлов

2. **Чистота базы данных**:
   - В базе данных всегда ровно 8 записей для астрологических систем
   - Нет дублирования контента или устаревших записей

3. **Производительность**:
   - Благодаря меньшему количеству файлов и записей улучшается производительность сайта
   - Быстрая загрузка страниц и ускоренная обработка запросов

## Запуск

Для запуска генерации гороскопов в режиме замены используйте:

```
python daily_horoscope_replace.py
```

Или с помощью скриптов:
- Windows: `run_horoscope_replace.bat`
- PowerShell: `.\run_horoscope_replace.ps1`
- Linux/Mac: `./run_horoscope_replace.sh`

## Проверка результатов

1. Проверка записей в базе данных:
```
python check_horoscope_images.py
```

2. Проверка файлов изображений:
```
dir app\static\uploads\blog\astro_*.png
```

## Планирование задач

Для регулярного запуска в режиме замены рекомендуется настроить планировщик задач:

1. **Windows Task Scheduler**:
   - Действие: `cmd.exe /c "cd C:\Users\ПК\astrolog_wars\work-site && run_horoscope_replace.bat"`
   - Расписание: ежедневно в 1:00

2. **Cron (Linux)**:
   ```
   0 1 * * * cd /path/to/work-site && python daily_horoscope_replace.py
   ```
